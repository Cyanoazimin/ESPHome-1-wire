esphome:
  name: ds2408-io-expander
  friendly_name: ESP32 DS2408 I/O Expander

esp32:
  board: esp32dev
  framework:
    type: arduino

# Enable logging
logger:

# Use local custom components
external_components:
  - source:
      type: local
      path: my_components

# Enable Home Assistant API
api:
  encryption:
    key: !secret haapi_password

ota:
  - platform: esphome
    password: !secret ota_password

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  reboot_timeout: 15min
  ap:
    ssid: "DS2408 I/O Fallback"
    password: !secret ap_password

mqtt:
  broker: 192.168.178.91
  port: 1883
  username: !secret "mqtt_username"
  password: !secret "mqtt_password"
  discovery: false

# 1-Wire BUS an GPIO 4
one_wire:
  - platform: gpio
    pin: GPIO4
    id: onewire_bus

# Custom DS2408 8-Channel Digital I/O
binary_sensor:
  - platform: ds2408
    one_wire_id: onewire_bus
    # TODO: Replace with the actual 64-bit address of your DS2408 device
    address: 0x0000000000000029
    update_interval: 1s
    
    channels:
      # - PIN 0: Example Motion Sensor
      - pin: 0
        name: "Bewegungsmelder Flur"
        on_press:
          then:
            - mqtt.publish:
                # TODO: Replace with the correct MQTT topic
                topic: "C40C/R/D/S/FL"
                payload: "1"
                retain: false
        on_release:
          then:
            - mqtt.publish:
                # TODO: Replace with the correct MQTT topic
                topic: "C40C/R/D/S/FL"
                payload: "0"
                retain: false

      # - PIN 1: Example Door Reed Switch
      - pin: 1
        name: "Haust√ºr Reed-Kontakt"
        device_class: door
        on_press:
          then:
            - mqtt.publish:
                # TODO: Replace with the correct MQTT topic
                topic: "C40C/A/D/S/7I"
                payload: "1"
                retain: false
        on_release:
          then:
            - mqtt.publish:
                # TODO: Replace with the correct MQTT topic
                topic: "C40C/A/D/S/7I"
                payload: "0"
                retain: false
      
      # - Add other channels from PIN 2 to 7 here as needed
      # - pin: 2
      #   name: "..."
      # - pin: 3
      #   name: "..."

captive_portal:
